"use strict";class e{constructor(e){this.config={container:".pix-container",nextButton:null,prevButton:null,loop:!1,infiniteLoop:!1,speed:300,slidesPerView:{default:1},gap:0,slidesToMove:1,autoplay:{enabled:!1,delay:3e3,pauseOnInteraction:!1,pauseAfterInteraction:!1},lazyMedia:!1,lazyMediaOffset:100,lazyPix:!1,lazyPixOffset:150,...e},this.state={currentIndex:0,totalSlides:0,slideWidth:0,isAnimating:!1,containerWidth:0,slidesPerView:1,carousels:[]}}init(e=null){const t=e||this.config.container;return document.querySelectorAll(t).forEach((e=>{this.config.lazyPix?this._observeInit(e):this._initSingleCarousel(e)})),window.addEventListener("resize",this._handleResize.bind(this)),this.config.autoplay.enabled&&this.state.carousels.forEach((e=>{this._setupAutoplay(e)})),this}_observeInit(e){const t=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&(this._initSingleCarousel(e),t.unobserve(e))}))}),{threshold:0,rootMargin:`${this.config.lazyPixOffset}px`});t.observe(e)}_initSingleCarousel(e){const t=e.querySelector(".pix-wrapper"),i=e.querySelectorAll(".pix-slide");if(!t||0===i.length)return void console.error("Carousel structure is invalid. Ensure you have .pix-wrapper and .pix-slide elements.");this.config.infiniteLoop&&(e.style.visibility="hidden");const n=Array.from(i).map(((e,t)=>(e.setAttribute("data-swipix-index",t),e))),s={container:e,wrapper:t,slides:Array.from(i),originalSlides:n,currentIndex:0,isInfinite:this.config.infiniteLoop,clonedSlides:[],realSlidesOffset:0,autoplayInterval:null,autoplayHandlers:null,tabGroups:[],isVisible:!1};if(this.state.carousels.push(s),this._applyStyles(s),this.config.infiniteLoop&&this._setupInfiniteLoop(s),this._calculateDimensions(s),s.wrapper.style.transition="none",this._positionSlides(s),s.wrapper.offsetWidth,s.wrapper.style.transition=`transform ${this.config.speed}ms ease`,this.config.infiniteLoop&&(e.style.visibility="visible"),this._initNavigation(s),this._initTouchEvents(s),this.config.tabsConfig&&this._initTabsGroups(s),this.config.lazyMedia&&this._observeVisibility(s),this.config.autoplay.enabled&&this.config.autoplay.pauseOnInteraction){const t=()=>{this._pauseAutoplay(s),this.config.autoplay.pauseAfterInteraction&&s.container.removeEventListener("mouseleave",i)},i=()=>{this.config.autoplay.pauseAfterInteraction||this._startAutoplay(s)};s.autoplayHandlers={pauseHandler:t,resumeHandler:i},e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",i)}}_observeVisibility(e){const t=e.container,i=new IntersectionObserver((t=>{t.forEach((t=>{e.isVisible=t.isIntersecting,t.isIntersecting&&this.config.lazyMedia&&this._lazyLoadMedia(e)}))}),{threshold:.1,rootMargin:`${this.config.lazyMediaOffset}px`});i.observe(t),e.visibilityObserver=i}_setupAutoplay(e){this._startAutoplay(e)}_startAutoplay(e){this._pauseAutoplay(e),e.autoplayInterval=setInterval((()=>{this.next(e.container)}),this.config.autoplay.delay)}_pauseAutoplay(e){clearInterval(e.autoplayInterval),e.autoplayInterval=null}_lazyLoadMedia(e){if(!e.isVisible)return;const t=e.currentIndex,i=t+e.slidesPerView;e.slides.slice(t,i).forEach((e=>{e.querySelectorAll("img[data-src], video[data-src]").forEach((e=>{const t=e.getAttribute("data-src");t&&!e.getAttribute("src")&&(e.setAttribute("src",t),e.removeAttribute("data-src"),"video"===e.tagName.toLowerCase()&&e.load())}))}))}_initTabsGroups(e){const t=this.config.tabsConfig;let i=[];if(Array.isArray(t))i=t;else{if(!t||"object"!=typeof t)return;i=[t]}e.tabGroups=[],i.forEach((t=>{const i=document.querySelector(t.container);if(!i)return void console.warn(`Tabs container not found for selector ${t.container}`);let n;n=t.buttonSelector?i.querySelectorAll(t.buttonSelector):i.children,n=Array.from(n),n.forEach(((i,n)=>{i.addEventListener("click",(()=>{let i=t.mapping&&Array.isArray(t.mapping)?t.mapping[n]:n;i<0||i>=e.totalSlides?console.warn(`Mapping for tab index ${n} is out-of-bound.`):this.slideTo(e.container,i)}))})),e.tabGroups.push({container:i,buttons:n,config:t}),this._updateTabsActiveGroup(e,t,n)}))}_updateTabsActive(e){e.tabGroups&&e.tabGroups.forEach((t=>{this._updateTabsActiveGroup(e,t.config,t.buttons)}))}_updateTabsActiveGroup(e,t,i){let n=e.currentIndex;e.isInfinite&&(n=e.currentIndex-e.realSlidesOffset),n=Math.max(0,Math.min(n,e.totalSlides-1));const s=t.activeClass||"active";if(t.rangeMapping&&Array.isArray(t.mapping)&&t.mapping.length>0){let e=0;for(let i=0;i<t.mapping.length;i++)n>=t.mapping[i]&&(e=i);i.forEach(((t,i)=>{i===e?t.classList.add(s):t.classList.remove(s)}))}else i.forEach(((e,i)=>{(t.mapping&&Array.isArray(t.mapping)?t.mapping[i]:i)===n?e.classList.add(s):e.classList.remove(s)}))}_setupInfiniteLoop(e){const{wrapper:t,originalSlides:i}=e;this._clearClonedSlides(e);const n=Object.values(this.config.slidesPerView),s=Math.max(...n),o=[];for(let e=0;e<s;e++){const n=e%i.length,s=i[n].cloneNode(!0);s.setAttribute("data-swipix-clone","end"),s.setAttribute("data-swipix-original-index",n),t.appendChild(s),o.push(s)}const a=[];for(let e=0;e<s;e++){const n=(i.length-1-e)%i.length,s=i[n].cloneNode(!0);s.setAttribute("data-swipix-clone","start"),s.setAttribute("data-swipix-original-index",n),t.insertBefore(s,t.firstChild),a.push(s)}e.clonedSlides=[...a,...o],e.realSlidesOffset=a.length,e.slides=Array.from(t.querySelectorAll(".pix-slide")),e.currentIndex=e.realSlidesOffset}_clearClonedSlides(e){const{wrapper:t,clonedSlides:i}=e;i&&i.length&&(i.forEach((e=>{e.parentNode===t&&t.removeChild(e)})),e.clonedSlides=[]),e.slides=[...e.originalSlides]}_applyStyles(e){const{container:t,wrapper:i,slides:n}=e;t.style.overflow="hidden",t.style.position="relative",i.style.display="flex",i.style.transition=`transform ${this.config.speed}ms ease`,i.style.willChange="transform",n.forEach((e=>{e.style.flexShrink="0",this.config.gap>0&&(e.style.marginRight=`${this.config.gap}px`)}))}_calculateDimensions(e){const{container:t,slides:i}=e,n=window.innerWidth;let s=this.config.slidesPerView.default;const o=Object.keys(this.config.slidesPerView).filter((e=>"default"!==e)).map((e=>parseInt(e,10))).sort(((e,t)=>t-e));for(const e of o)if(n>=e){s=this.config.slidesPerView[e];break}e.slidesPerView=s,e.containerWidth=t.offsetWidth;const a=this.config.gap*(s-1);e.slideWidth=(e.containerWidth-a)/s,e.totalSlides=e.originalSlides.length,i.forEach((t=>{t.style.width=`${e.slideWidth}px`})),e.gap=this.config.gap,e.isInfinite&&this._setupInfiniteLoop(e),this._positionSlides(e)}_positionSlides(e){const{wrapper:t,currentIndex:i,slideWidth:n,gap:s}=e,o=-i*(n+s);t.style.transform=`translateX(${o}px)`,this.config.lazyMedia&&e.isVisible&&this._lazyLoadMedia(e)}_checkInfiniteLoopReset(e){if(!e.isInfinite)return;const{currentIndex:t,realSlidesOffset:i,totalSlides:n,wrapper:s}=e,o=i+n;t<i?(s.style.transition="none",e.currentIndex=o-(i-t),this._positionSlides(e),s.offsetWidth,s.style.transition=`transform ${this.config.speed}ms ease`):t>=o&&(s.style.transition="none",e.currentIndex=i+(t-o),this._positionSlides(e),s.offsetWidth,s.style.transition=`transform ${this.config.speed}ms ease`)}_initNavigation(e){const{container:t}=e;if(this.config.nextButton){const e=t.querySelector(this.config.nextButton)||document.querySelector(this.config.nextButton);e&&e.addEventListener("click",(()=>{this.next(t)}))}if(this.config.prevButton){const e=t.querySelector(this.config.prevButton)||document.querySelector(this.config.prevButton);e&&e.addEventListener("click",(()=>{this.prev(t)}))}}_initTouchEvents(e){const{container:t,wrapper:i}=e;let n,s,o=!1,a=0;const r=e=>{const t=e.target.tagName.toLowerCase();if(["input","button","select","textarea"].includes(t))return;e.preventDefault(),n="touchstart"===e.type?e.touches[0].clientX:e.clientX,o=!0;const s=window.getComputedStyle(i).getPropertyValue("transform"),r=new DOMMatrix(s);a=r.m41,i.style.transition="none",i.style.cursor="grabbing"},l=t=>{if(!o)return;s="touchmove"===t.type?t.touches[0].clientX:t.clientX;const r=s-n;let l=r;if(!e.isInfinite&&!this.config.loop){const t=e.totalSlides-e.slidesPerView;0===e.currentIndex&&r>0&&(l=.3*r),e.currentIndex===t&&r<0&&(l=.3*r)}i.style.transform=`translateX(${a+l}px)`},c=a=>{if(!o)return;i.style.transition=`transform ${this.config.speed}ms ease`,i.style.cursor="grab";const r=("touchend"===a.type?a.changedTouches?a.changedTouches[0].clientX:s:a.clientX||s)-n,l=e.totalSlides-e.slidesPerView,c=e.currentIndex===(e.isInfinite?e.realSlidesOffset:0),d=e.currentIndex===(e.isInfinite?e.realSlidesOffset+l:l);Math.abs(r)>50?r>0&&(!c||this.config.loop||e.isInfinite)?this.prev(t):r<0&&(!d||this.config.loop||e.isInfinite)?this.next(t):this._positionSlides(e):this._positionSlides(e),o=!1;const u=new CustomEvent("swipix:slideChanged",{detail:{carousel:this,container:t,currentIndex:e.currentIndex}});document.dispatchEvent(u)};t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("touchmove",l,{passive:!0}),t.addEventListener("touchend",c),t.addEventListener("mousedown",r),window.addEventListener("mousemove",l),window.addEventListener("mouseup",c),i.style.cursor="grab",e.eventHandlers={handleDragStart:r,handleDragMove:l,handleDragEnd:c}}_handleResize(){this.state.carousels.forEach((e=>{this._calculateDimensions(e)}))}_getCarouselData(e){return"string"==typeof e&&(e=document.querySelector(e)),this.state.carousels.find((t=>t.container===e))||null}next(e){const t=this._getCarouselData(e);if(!t||t.isAnimating)return this;t.isAnimating=!0;const i=this.config.slidesToMove;if(t.isInfinite)t.currentIndex+=i;else{const e=t.totalSlides-t.slidesPerView;if(t.currentIndex+i>e){if(!this.config.loop)return t.currentIndex=e,t.isAnimating=!1,this;t.currentIndex=0}else t.currentIndex+=i}return this._positionSlides(t),t.isInfinite&&setTimeout((()=>{this._checkInfiniteLoopReset(t)}),this.config.speed),setTimeout((()=>{t.isAnimating=!1,this._updateTabsActive(t);const i=new CustomEvent("swipix:slideChanged",{detail:{carousel:this,container:e,currentIndex:t.currentIndex}});document.dispatchEvent(i)}),this.config.speed),this}prev(e){const t=this._getCarouselData(e);if(!t||t.isAnimating)return this;t.isAnimating=!0;const i=this.config.slidesToMove;if(t.isInfinite)t.currentIndex-=i;else if(t.currentIndex-i<0){if(!this.config.loop)return t.currentIndex=0,t.isAnimating=!1,this;t.currentIndex=t.totalSlides-t.slidesPerView}else t.currentIndex-=i;return this._positionSlides(t),t.isInfinite&&setTimeout((()=>{this._checkInfiniteLoopReset(t)}),this.config.speed),setTimeout((()=>{t.isAnimating=!1,this._updateTabsActive(t);const i=new CustomEvent("swipix:slideChanged",{detail:{carousel:this,container:e,currentIndex:t.currentIndex}});document.dispatchEvent(i)}),this.config.speed),this}goTo(e,t){const i=this._getCarouselData(e);if(!i||i.isAnimating)return this;i.isAnimating=!0;const n=i.totalSlides-i.slidesPerView;let s=t;return i.isInfinite&&(s=t+i.realSlidesOffset),s<(i.isInfinite?i.realSlidesOffset:0)?i.currentIndex=i.isInfinite?i.realSlidesOffset:0:s>(i.isInfinite?i.realSlidesOffset+n:n)?i.currentIndex=i.isInfinite?i.realSlidesOffset+n:n:i.currentIndex=s,this._positionSlides(i),setTimeout((()=>{i.isAnimating=!1,i.isInfinite&&this._checkInfiniteLoopReset(i),this._updateTabsActive(i);const t=new CustomEvent("swipix:slideChanged",{detail:{carousel:this,container:e,currentIndex:i.currentIndex}});document.dispatchEvent(t)}),this.config.speed),this}slideTo(e,t){"number"==typeof e&&(t=e,e=this.state.carousels[0].container);const i=this._getCarouselData(e);if(!i||i.isAnimating)return this;i.isAnimating=!0;const n=i.totalSlides,s=Math.max(0,Math.min(t,n-1));let o=s;return i.isInfinite&&(o=s+i.realSlidesOffset),i.currentIndex=o,this._positionSlides(i),i.isInfinite&&setTimeout((()=>{this._checkInfiniteLoopReset(i)}),this.config.speed),setTimeout((()=>{i.isAnimating=!1,this._updateTabsActive(i);const t=new CustomEvent("swipix:slideChanged",{detail:{carousel:this,container:e,currentIndex:i.currentIndex}});document.dispatchEvent(t)}),this.config.speed),this}updateConfig(e){return e.autoplay&&(this.config.autoplay={enabled:void 0!==e.autoplay.enabled?e.autoplay.enabled:this.config.autoplay.enabled,delay:void 0!==e.autoplay.delay?e.autoplay.delay:this.config.autoplay.delay,pauseOnInteraction:void 0!==e.autoplay.pauseOnInteraction?e.autoplay.pauseOnInteraction:this.config.autoplay.pauseOnInteraction,pauseAfterInteraction:void 0!==e.autoplay.pauseAfterInteraction?e.autoplay.pauseAfterInteraction:this.config.autoplay.pauseAfterInteraction},delete e.autoplay),this.config={...this.config,...e},this.state.carousels.forEach((e=>{if(this.config.infiniteLoop!==e.isInfinite&&(e.isInfinite=this.config.infiniteLoop,e.isInfinite?this._setupInfiniteLoop(e):(this._clearClonedSlides(e),e.currentIndex=Math.min(e.currentIndex-e.realSlidesOffset,e.totalSlides-e.slidesPerView),e.currentIndex=Math.max(0,e.currentIndex),e.realSlidesOffset=0)),this._applyStyles(e),this._calculateDimensions(e),this.config.tabsConfig&&this._initTabsGroups(e),this._pauseAutoplay(e),this.config.autoplay.enabled&&this._startAutoplay(e),this.config.autoplay.enabled&&this.config.autoplay.pauseOnInteraction)if(e.autoplayHandlers&&(e.container.removeEventListener("mouseenter",e.autoplayHandlers.pauseHandler),e.container.removeEventListener("mouseleave",e.autoplayHandlers.resumeHandler)),this.config.autoplay.pauseAfterInteraction){const t=()=>{this._pauseAutoplay(e),e.container.removeEventListener("mouseleave",i)},i=()=>{};e.autoplayHandlers={pauseHandler:t,resumeHandler:i},e.container.addEventListener("mouseenter",t)}else{const t=()=>this._pauseAutoplay(e),i=()=>this._startAutoplay(e);e.autoplayHandlers={pauseHandler:t,resumeHandler:i},e.container.addEventListener("mouseenter",t),e.container.addEventListener("mouseleave",i)}})),this}destroy(){window.removeEventListener("resize",this._handleResize.bind(this)),this.state.carousels.forEach((e=>{const{container:t,wrapper:i,slides:n,eventHandlers:s}=e;e.isInfinite&&this._clearClonedSlides(e),t.style.overflow="",t.style.position="",i.style.display="",i.style.transition="",i.style.transform="",i.style.willChange="",i.style.cursor="",n.forEach((e=>{e.style.flexShrink="",e.style.width="",e.style.marginRight=""})),s&&(t.removeEventListener("touchstart",s.handleDragStart,{passive:!1}),t.removeEventListener("touchmove",s.handleDragMove,{passive:!0}),t.removeEventListener("touchend",s.handleDragEnd),t.removeEventListener("mousedown",s.handleDragStart),window.removeEventListener("mousemove",s.handleDragMove),window.removeEventListener("mouseup",s.handleDragEnd));const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t)})),this.state.carousels=[]}}"undefined"!=typeof module&&module.exports?module.exports=e:window.Swipix=e;
//# sourceMappingURL=swipix.cjs.js.map
